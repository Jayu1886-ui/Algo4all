{% extends "base.html" %}

{% block title %}Dashboard | ALGO4ALL{% endblock %}

{% block content %}
<!-- Main container with vertical spacing -->
<div class="p-4 space-y-4">
  
  <!-- Status Bar (Assumed to be in base.html or a separate common element) -->
  <div id="status-bar" class="p-3 rounded-xl shadow-lg text-center font-bold bg-blue-100 text-blue-800 border border-blue-400 transition-all duration-300">
      <span id="status-message">Connecting to server...</span>
  </div>

  <!-- Overall Trend Section (FIXED IDs to match 'CALL BUY'/'PUT BUY' signals) -->
  <div class="bg-black text-white p-2 rounded-xl shadow-lg text-center">
    <span class="text-xl font-bold">Trend Signal : </span>
    <!-- IDs match the exact signals: CALL BUY, PUT BUY -->
    <span id="trend-signal-call_buy" class="text-green-500 font-bold text-xl hidden">CALL BUY</span>
    <span id="trend-signal-put_buy" class="text-red-500 font-bold text-xl hidden">PUT BUY</span>
    <span id="overall-trend-neutral" class="text-gray-400 font-bold text-xl">Neutral / Indecisive</span>
  </div>

  <!-- Nifty 50 Section -->
  <div class="bg-gradient-to-r from-blue-700 to-blue-500 text-white p-2 rounded-xl shadow-lg">
    <div class="flex justify-between items-center">
      <span class="text-lg font-bold">Nifty 50 :</span>
      <!-- This will show the calculated signal (e.g., 'CALL BUY' or 'NEUTRAL') -->
      <span id="nifty_50-signal" class="text-lg font-bold">--</span> 
    </div>
    <div class="grid grid-cols-2 gap-x-4 gap-y-1 mt-1 text-base">
        <!-- IDs for LTP and SMAs -->
        <span>LTP : <span id="nifty_50-ltp" class="font-semibold">----.--</span></span>
        <span>SMA 10 : <span id="nifty_50-sma10" class="font-semibold">----.--</span></span>
        <span>SMA 25 : <span id="nifty_50-sma25" class="font-semibold">----.--</span></span>
        <span>SMA 50 : <span id="nifty_50-sma50" class="font-semibold">----.--</span></span>
        <span>SMA 100 : <span id="nifty_50-sma100" class="font-semibold">----.--</span></span>
    </div>
  </div>

  <!-- ATM OPTIONS SECTION -->
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
    
    <!-- HIDDEN DATA ATTRIBUTES for Task 9 Metadata -->
    <div id="option-meta-data" 
         data-expiry-date="" 
         data-atm-strike=""
         class="hidden">
    </div>

    <!-- ATM Call Option -->
    <div class="bg-blue-600 text-white p-2 rounded-lg shadow-lg space-y-1">
      <div class="flex justify-between items-center text-base font-bold">
        <!-- ATM CALL Strike -->
        <span>ATM CALL: <span id="atm-call-strike">----</span></span>
        <!-- Expiry Date -->
        <span id="atm-expiry-date" class="text-xs font-normal">--</span>
      </div>      
      <!-- HIDDEN INSTRUMENT KEY (Set by JS from Task 9 cache data) -->
      <span id="atm-call-key" class="hidden"></span> 
    </div>

    <!-- ATM Put Option -->
    <div class="bg-gray-700 text-white p-2 rounded-lg shadow-lg space-y-1">
      <div class="flex justify-between items-center text-base font-bold">
        <!-- ATM PUT Strike -->
        <span>ATM PUT: <span id="atm-put-strike">----</span></span>
      </div>
      <!-- HIDDEN INSTRUMENT KEY -->
      <span id="atm-put-key" class="hidden"></span>
    </div>

  </div>

    <!-- ACTIVE TRADE AND LIVE PNL SECTION -->
    <div id="active-trade-section" class="bg-purple-800 text-white p-3 rounded-xl shadow-lg hidden">
        <div class="flex justify-between items-center text-xl font-bold mb-2">
            <span>ACTIVE TRADE</span>
            <span id="active-trade-type" class="text-yellow-300">--</span>
        </div>
        <div class="grid grid-cols-2 gap-x-4 gap-y-1 text-base">
            <div class="flex justify-between"><span>Instrument</span><span id="active-trade-instrument" class="font-semibold">--</span></div>
            <div class="flex justify-between"><span>Entry Price</span><span id="active-trade-entry-price" class="font-semibold">----.--</span></div>
            <div class="col-span-2 flex justify-between items-center mt-2">
                <span class="text-lg font-bold">Live PnL</span>
                <span id="live-pnl" class="text-2xl font-extrabold text-yellow-300">---.--</span>
            </div>
        </div>
        <!-- Square-Off Button/Form -->
        <form id="square-off-form" class="mt-4 text-center">
             <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition-colors">
                EMERGENCY SQUARE OFF
            </button>
        </form>
    </div>
    
</div>
{% endblock %}

{% block scripts %}
  <script src="{{ url_for('static', filename='js/socket.io.min.js') }}"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
{% endblock %}